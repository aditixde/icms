import{c as _,r as x,j as e,S as q,B}from"./index-B9bZ70Jv.js";import{a as F,b as R,E as T,C as O,S as I}from"./SectorCard-3h9PrRuI.js";import{T as D,P as L,M as V}from"./MarketSummary-BWtPZG1M.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=_("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=_("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=_("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),U=({results:d})=>{const b=x.useRef(null);if(x.useEffect(()=>{if(!b.current||!d)return;const a=b.current,t=a.getContext("2d");if(!t)return;const u=a.getBoundingClientRect();a.width=u.width*window.devicePixelRatio,a.height=u.height*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio);const f=u.width,p=u.height,n=60,w=f-2*n,v=p-2*n;t.clearRect(0,0,f,p);const h=d.sectors.map(r=>({name:r.sector,balance:r.ccc_balance,position:r.net_position}));h.sort((r,m)=>m.balance-r.balance);const C=Math.max(...h.map(r=>Math.abs(r.balance))),c=w/h.length*.8,P=w/h.length*.2;t.strokeStyle="#E5E7EB",t.lineWidth=1,t.beginPath(),t.moveTo(n,n),t.lineTo(n,p-n),t.stroke();const o=n+v/2;t.strokeStyle="#374151",t.lineWidth=2,t.beginPath(),t.moveTo(n,o),t.lineTo(f-n,o),t.stroke(),h.forEach((r,m)=>{const g=n+m*(c+P)+P/2,j=Math.abs(r.balance)/C*(v/2-10);let N="#6B7280";r.position==="Seller"?N="#10B981":r.position==="Buyer"&&(N="#EF4444"),t.fillStyle=N,r.balance>=0?t.fillRect(g,o-j,c,j):t.fillRect(g,o,c,j),t.fillStyle="#1F2937",t.font="bold 10px sans-serif",t.textAlign="center";const S=r.balance>=0?o-j-5:o+j+15;t.fillText(r.balance.toFixed(1),g+c/2,S),t.save(),t.translate(g+c/2,p-n+15),t.rotate(-Math.PI/4),t.fillStyle="#374151",t.font="11px sans-serif",t.textAlign="right",t.fillText(r.name,0,0),t.restore()}),t.fillStyle="#6B7280",t.font="10px sans-serif",t.textAlign="right";for(let r=1;r<=4;r++){const m=C/4*r,g=o-(v/2-10)*(r/4);t.fillText(`+${m.toFixed(1)}`,n-10,g+3)}for(let r=1;r<=4;r++){const m=C/4*r,g=o+(v/2-10)*(r/4);t.fillText(`-${m.toFixed(1)}`,n-10,g+3)}t.fillStyle="#374151",t.font="bold 12px sans-serif",t.textAlign="center",t.fillText("CCC Balance (Mt CO₂)",f/2,p-10),t.save(),t.translate(15,p/2),t.rotate(-Math.PI/2),t.fillText("Surplus ← → Deficit",0,0),t.restore(),t.fillStyle="#1F2937",t.font="bold 14px sans-serif",t.textAlign="center",t.fillText("Sector Positions in Carbon Credit Market",f/2,25)},[d]),!d)return null;const M=d.sectors.filter(a=>a.net_position==="Buyer").length,y=d.sectors.filter(a=>a.net_position==="Seller").length,E=d.sectors.filter(a=>a.net_position==="Neutral").length;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("canvas",{ref:b,className:"w-full border border-gray-200 rounded-lg",style:{width:"100%",height:"400px"}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-6 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-600 rounded"}),e.jsxs("span",{className:"text-gray-700",children:["Sellers (",y,")"]}),e.jsx("span",{className:"text-gray-500",children:"- Have surplus credits"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-600 rounded"}),e.jsxs("span",{className:"text-gray-700",children:["Buyers (",M,")"]}),e.jsx("span",{className:"text-gray-500",children:"- Need to buy credits"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-600 rounded"}),e.jsxs("span",{className:"text-gray-700",children:["Neutral (",E,")"]}),e.jsx("span",{className:"text-gray-500",children:"- Balanced position"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Market Balance:"})," ",d.total_ccc_supply.toFixed(2)," Mt CO₂",e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs font-medium ${Math.abs(d.total_ccc_supply)<.1?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:Math.abs(d.total_ccc_supply)<.1?"Balanced":"Imbalanced"})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Market Insights"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-700 font-medium",children:"Supply Side"}),e.jsxs("div",{className:"text-blue-600",children:[y," sectors generating ",d.sectors.filter(a=>a.ccc_balance>0).reduce((a,t)=>a+t.ccc_balance,0).toFixed(1)," Mt surplus"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-700 font-medium",children:"Demand Side"}),e.jsxs("div",{className:"text-blue-600",children:[M," sectors needing ",Math.abs(d.sectors.filter(a=>a.ccc_balance<0).reduce((a,t)=>a+t.ccc_balance,0)).toFixed(1)," Mt credits"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-blue-700 font-medium",children:"Price Impact"}),e.jsxs("div",{className:"text-blue-600",children:["₹",d.carbon_price.toFixed(2),"/tCO₂ equilibrium price"]})]})]})]})]})},G=({onResultsChange:d})=>{const[b,M]=x.useState(null),[y,E]=x.useState(!1),[a,t]=x.useState(0),[u,f]=x.useState(200),[p,n]=x.useState(F),[w,v]=x.useState(R),[h,C]=x.useState(T),[c,P]=x.useState(!1),[o,r]=x.useState(!0),[m]=x.useState(()=>new O);x.useEffect(()=>{m.updateSectoralData(p),m.updateCostData(w),m.updateElasticityData(h),o&&!y&&j()},[p,w,h,o,a,u]);const g=()=>{n({...F}),v({...R}),C({...T}),t(0),f(200)},j=async()=>{E(!0);try{const s=m.findEquilibriumPrice(a,u);M(s),d(s)}catch(s){console.error("Equilibrium finding error:",s)}finally{E(!1)}},N=(s,i,l)=>{n(k=>({...k,[s]:{...k[s],[i]:l}}))},S=(s,i,l)=>{v(k=>({...k,[s]:{...k[s],[i]:l}}))},A=(s,i)=>{C(l=>({...l,[s]:i}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Equilibrium Price Finder"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Find the market-clearing carbon price using bisection method"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:s=>r(s.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-gray-700",children:"Auto-update"})]}),e.jsxs("button",{onClick:()=>P(!c),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${c?"bg-orange-100 text-orange-700 hover:bg-orange-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:c?"View Mode":"Edit Data"})]}),e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Reset Defaults"})]}),e.jsxs("button",{onClick:j,disabled:y,className:"flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:y?"Finding Equilibrium...":"Find Equilibrium"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-medium text-blue-900",children:"Price Search Range"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Minimum Price (P_min)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"₹"}),e.jsx("input",{type:"number",value:a,onChange:s=>t(Math.max(0,Number(s.target.value))),className:"flex-1 px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0",step:"1"}),e.jsx("span",{className:"text-sm text-blue-600",children:"/tCO₂"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-blue-700 mb-2",children:"Maximum Price (P_max)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"₹"}),e.jsx("input",{type:"number",value:u,onChange:s=>f(Math.max(a+1,Number(s.target.value))),className:"flex-1 px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:a+1,step:"1"}),e.jsx("span",{className:"text-sm text-blue-600",children:"/tCO₂"})]})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-blue-700",children:[e.jsx("strong",{children:"Search Range:"})," ₹",a," - ₹",u," per tCO₂",e.jsxs("span",{className:"ml-2 text-blue-600",children:["(Range: ₹",u-a,")"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Sectoral Data"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sector"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Emissions (Mt CO₂)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Production"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Intensity (tCO₂/unit)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Target (tCO₂/unit)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Elasticity"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(p).map(([s,i])=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.emissions,onChange:l=>N(s,"emissions",Number(l.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.1"}):i.emissions}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.production,onChange:l=>N(s,"production",Number(l.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.1"}):i.production}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.intensity,onChange:l=>N(s,"intensity",Number(l.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01"}):i.intensity.toFixed(2)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.target,onChange:l=>N(s,"target",Number(l.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01"}):i.target.toFixed(2)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:h[s],onChange:l=>A(s,Number(l.target.value)),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"0.01",min:"0",max:"1"}):h[s].toFixed(2)})]},s))})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Cost Data (Rs per unit)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sector"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fixed Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variable Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(w).map(([s,i])=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.fixed_cost,onChange:l=>S(s,"fixed_cost",Number(l.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"100"}):i.fixed_cost.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.variable_cost,onChange:l=>S(s,"variable_cost",Number(l.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"100"}):i.variable_cost.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c?e.jsx("input",{type:"number",value:i.price,onChange:l=>S(s,"price",Number(l.target.value)),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",step:"100"}):i.price.toLocaleString()})]},s))})]})})]})]}),!b&&!y&&e.jsxs("div",{className:"text-center py-12 mt-8",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ready to Find Equilibrium"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'Configure the price search range above and click "Find Equilibrium" to calculate the market-clearing carbon price.'}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"How it works"}),e.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"Uses bisection method to search between P_min and P_max until finding the equilibrium where market supply equals demand."})]})]})})]}),y&&e.jsxs("div",{className:"text-center py-12 mt-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Computing Equilibrium..."}),e.jsxs("p",{className:"text-gray-600",children:["Searching between ₹",a," - ₹",u," for market-clearing price"]})]})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx(V,{results:b,showEquilibriumInfo:!0}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(B,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sector Positions at Equilibrium"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual representation of each sector's carbon credit balance"})]})]}),e.jsx(U,{results:b})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Detailed Sector Analysis"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.sectors.map(s=>e.jsx(I,{result:s},s.sector))})]})]})]})};export{G as EquilibriumFinder};
